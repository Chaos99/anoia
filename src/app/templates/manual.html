<!DOCTYPE html>
{% extends "layout.html" %}

{% block nav %}
{{ super() }}
{% endblock %}

{% block list %}
<div class="table-responsive-sm">
    <table id="table_id" class="table table-striped table-bordered table-hover">
        <thead class="thead-dark">
            <tr id="row">
                <th class="id">ID_full</th>
                <th class="id">ID</th>
                <th class="status">Status</th>
                <th class="desc">Description</th>
                <th class="materials">Materials</th>
                <th class="tags">Tags</th>
                <th class="danger">Danger</th>
                <th class="location">Location</th>
                <th class="comment">Comments</th>
                <th class="func1">Remove</th>
                <th class="func2">Modify</th>
            </tr>
        </thead>
        <tbody>
            {% for todo in todos %}
            <tr class="datas">
                <td class="id">{{ todo._id }}</td>
                <td class="id">{{ (todo._id|string)[0:5] }}</td>
                <td><input type="image" src="../static/assets/images/yes.png" alt="Submit ME"></td>
                <td class="desc">{{todo.desc}}</td>
                <td class="length">{{todo.materials}}</td>
                <td class="width">{{todo.tags}}</td>
                <td class="thick">{{todo.danger}}</td>
                <td class="mat">{{todo.location}}</td>
                <td class="comment">{{todo.comments}}</td>
                <td class="func1"><a href="./remove?_id={{ todo['_id'] }}"><button type="submit" class="btn btn-outline-danger">DELETE</button></a></td>
                <td class="func1"><a href="./update?_id={{ todo['_id'] }}"><button type="submit" class="btn btn-outline-primary">EDIT</button></a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block actionbar %}
<form action="/action/{{ type }}" method="POST">
    <table class="table table-dark">
        <thead>
            <tr>
                <td><b><label>Add an item : </label></b></td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><textarea name="desc" rows="1" cols="20" placeholder="Enter Description here..."></textarea></td>
                <td><input type="text" name="materials" placeholder="useful for which materials" /></td>
                <td><input type="text" name="tags" placeholder="tags (kind of tool, actions, group)" /></td>
                <td><input type="text" name="danger" placeholder="danger level" /></td>
                <td><input type="text" name="locations" placeholder="location" /></td>
                <td><input type="text" name="comments" placeholder="comments" /></td>
                <td><button type="submit"> Create </button></td>
            </tr>
        </tbody>
    </table>
</form>

{% endblock %}

{% block details %}
<script type="text/javascript">
    $('#table_id tbody').on('click', 'tr', function() {

        //console.log(`ID is ${data[0]}`);
        var id = document.getElementById("card_columns");
        while (id.firstChild) {
            id.removeChild(id.firstChild);
        }
        var selection = $('#table_id').dataTable().api().row(this).data();
        console.log(`requesting id ${selection[0]}`);
        $.post('/getdetail', {
            id: selection[0]
        }).done(function(response) {
            console.log(`Retrieved: ${response.name}`);
            var data = response;
            const entries = Object.entries(data);
            for (const [key, value] of entries) {
                if (key != "_id") {
                var div1 = document.createElement("div");
                div1.class = "card border";
                var div2 = document.createElement("div");
                div2.class = "card-header";
                div2.innerHTML = `${key}`;
                var div3 = document.createElement("div");
                div3.class = "card-body";
                var div4 = document.createElement("div");
                div4.class = "card-text";
                div4.innerHTML = `${value}`;

                div3.appendChild(div4);
                div1.appendChild(div2);
                div1.appendChild(div3);

                id.appendChild(div1);
                }
            }
        }).fail(function() {
            console.log(`no or invalid response`);
            var data = $(selection);
        });
    });

</script>
<div class="card" id="details">
    <div class="card-header">Details:</div>

    <div class="card-body container">
        <div class="card-columns w-95" id="card_columns">

        </div>
    </div>
</div>
{% endblock %}
